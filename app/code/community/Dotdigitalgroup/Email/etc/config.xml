<?xml version="1.0"?>
<config>
    <modules>
        <Dotdigitalgroup_Email>
            <version>2.0.4</version>
        </Dotdigitalgroup_Email>
    </modules>
    <frontend>
        <routers>
            <connector>
                <use>standard</use>
                <args>
                    <module>Dotdigitalgroup_Email</module>
                    <frontName>connector</frontName>
                </args>
            </connector>
        </routers>
        <layout>
            <updates>
                <connector>
                    <file>connector.xml</file>
                </connector>
            </updates>
        </layout>
    </frontend>
    <global>
        <models>
            <connector>
                <class>Dotdigitalgroup_Email_Model</class>
                <resourceModel>connector_resource</resourceModel>
            </connector>
            <connector_resource>
                <class>Dotdigitalgroup_Email_Model_Resource</class>
                <entities>
                    <email_order>
                        <table>email_order</table>
                    </email_order>
                    <email_contact>
                        <table>email_contact</table>
                    </email_contact>
                    <email_send>
                        <table>email_send</table>
                    </email_send>
                </entities>
            </connector_resource>
            <resources>
                <connector_setup>
                    <setup>
                        <module>Dotdigitalgroup_Email</module>
                        <class>Dotdigitalgroup_Email_Model_Resource_Setup</class>
                    </setup>
                    <connection>
                        <use>core_setup</use>
                    </connection>
                </connector_setup>
                <connector_api_write>
                    <connection>
                        <use>core_write</use>
                    </connection>
                </connector_api_write>
                <connector_api_read>
                    <connection>
                        <use>core_read</use>
                    </connection>
                </connector_api_read>
            </resources>
            <sales>
                <rewrite>
                    <order>Dotdigitalgroup_Email_Model_Sales_Order_State</order>
                </rewrite>
            </sales>
        </models>
        <helpers>
            <connector>
                <class>Dotdigitalgroup_Email_Helper</class>
            </connector>
        </helpers>
        <blocks>
            <connector>
                <class>Dotdigitalgroup_Email_Block</class>
            </connector>
        </blocks>
        <resources>
            <connector_setup>
                <setup>
                    <module>Dotdigitalgroup_Email</module>
                    <class>Mage_Sales_Model_Mysql4_Setup</class>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </connector_setup>
            <customer_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </customer_write>
            <customer_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </customer_read>
        </resources>
        <events>
            <admin_system_config_changed_section_connector_api_settings>
                <observers>
                    <check_timezone_config>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>actionConfigSaveAfter</method>
                    </check_timezone_config>
                </observers>
            </admin_system_config_changed_section_connector_api_settings>
            <admin_system_config_changed_section_connector_sync_settings>
                <observers>
                    <reset_contacts>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>actionConfigResetContacts</method>
                    </reset_contacts>
                </observers>
            </admin_system_config_changed_section_connector_sync_settings>
            <admin_system_config_changed_section_connector_data_field_settings>
                <observers>
                    <reset_contacts_on_datamapping>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>actionConfigResetContacts</method>
                    </reset_contacts_on_datamapping>
                </observers>
            </admin_system_config_changed_section_connector_data_field_settings>
            <customer_save_after>
                <observers>
                    <contactid>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>handleCustomerSaveBefore</method>
                    </contactid>
                </observers>
            </customer_save_after>
            <newsletter_subscriber_save_before>
                <observers>
                    <connector_newsletter_subscriber_save_after>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>newsletterSubscriberSave</method>
                    </connector_newsletter_subscriber_save_after>
                </observers>
            </newsletter_subscriber_save_before>
            <sales_order_save_after>
                <observers>
                    <connector_checkout_type_onepage_save_order_after>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>handleSalesOrderSaveAfter</method>
                    </connector_checkout_type_onepage_save_order_after>
                </observers>
            </sales_order_save_after>
            <!--<sales_quote_save_after>-->
                <!--<observers>-->
                    <!--<connector_sales_quote_save_after>-->
                        <!--<class>Dotdigitalgroup_Email_Model_Observer</class>-->
                        <!--<method>handleSalesQuoteSaveAfter</method>-->
                    <!--</connector_sales_quote_save_after>-->
                <!--</observers>-->
            <!--</sales_quote_save_after>-->
            <sales_order_creditmemo_save_after>
                <observers>
                    <connector_sales_order_payment_refund>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>handleSalesOrderRefund</method>
                    </connector_sales_order_payment_refund>
                </observers>
            </sales_order_creditmemo_save_after>
            <order_cancel_after>
                <observers>
                    <connector_sales_order_cancel>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>hangleSalesOrderCancel</method>
                    </connector_sales_order_cancel>
                </observers>
            </order_cancel_after>
            <sales_order_status_after>
                <observers>
                    <connector_sales_order_status_change>
                        <class>Dotdigitalgroup_Email_Model_Observer</class>
                        <method>handleSalesOrderStatusChange</method>
                    </connector_sales_order_status_change>
                </observers>
            </sales_order_status_after>
        </events>
    </global>
    <adminhtml>
        <translate>
            <modules>
                <Dotdigitalgroup_Email>
                    <files>
                        <default>Dotdigitalgroup_Email.csv</default>
                    </files>
                </Dotdigitalgroup_Email>
            </modules>
        </translate>
    </adminhtml>
    <admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <Dotdigitalgroup_Email before="Mage_Adminhtml">Dotdigitalgroup_Email_Adminhtml</Dotdigitalgroup_Email>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
    <crontab>
        <jobs>
            <connector_email_customer_sync>
                <run><model>connector/cron::contactSync</model></run>
                <schedule>
                    <cron_expr>*/15 * * * *</cron_expr>
                </schedule>
            </connector_email_customer_sync>
            <connector_email_subscriber_and_suppressed_sync>
                <run><model>connector/cron::subscribersAndSuppressedSync</model></run>
                <schedule>
                    <cron_expr>*/15 * * * *</cron_expr>
                </schedule>
            </connector_email_subscriber_and_suppressed_sync>
            <connector_email_lostbaskets>
                <run><model>connector/cron::lostBaskets</model></run>
                <schedule>
                    <cron_expr>*/5 * * * *</cron_expr>
                </schedule>
            </connector_email_lostbaskets>
            <!--<connector_email_sender>-->
                <!--<run>-->
                    <!--<model>connector/cron::sendMail</model>-->
                <!--</run>-->
                <!--<schedule>-->
                    <!--<cron_expr>02,07,12,17,22,27,32,37,42,47,52,57 * * * *</cron_expr>-->
                <!--</schedule>-->
            <!--</connector_email_sender>-->
            <connector_email_order_sync>
                <run><model>connector/cron::orderSync</model></run>
                <schedule>
                    <cron_expr>*/15 * * * *</cron_expr>
                </schedule>
            </connector_email_order_sync>
            <connector_email_cleaner>
                <run><model>connector/cron::cleaning</model></run>
                <schedule>
                    <cron_expr>* * 1 * * </cron_expr>
                </schedule>
            </connector_email_cleaner>
        </jobs>
    </crontab>
    <default>
        <connector_api_settings>
            <api_credentials>
                <username></username>
                <password></password>
            </api_credentials>
        </connector_api_settings>
        <connector_sync_settings>
            <sync_customer_schedule>
                <enabled>0</enabled>
                <time></time>
                <frequency></frequency>
                <cronschedule></cronschedule>
            </sync_customer_schedule>
            <sync_suppressed_schedule>
                <enabled>0</enabled>
                <time></time>
                <frequency></frequency>
                <cronschedulesupp></cronschedulesupp>
            </sync_suppressed_schedule>
            <transactional_data>
                <order_enabled>0</order_enabled>
                <wishlist_enabled>0</wishlist_enabled>
            </transactional_data>
        </connector_sync_settings>
        <connector_data_field_settings>
            <customer_data>
                <customer_id></customer_id>
                <title></title>
                <firstname></firstname>
                <lastname></lastname>
                <dob></dob>
                <gender></gender>
                <website_name></website_name>
                <store_name></store_name>
                <customer_created_date></customer_created_date>
                <last_logged_in></last_logged_in>
                <customer_group></customer_group>
                <address_title></address_title>
                <billing_address_1></billing_address_1>
                <billing_address_2></billing_address_2>
                <billing_city></billing_city>
                <billing_state></billing_state>
                <billing_country></billing_country>
                <billing_postcode></billing_postcode>
                <billing_telephone></billing_telephone>
                <delivery_address_1></delivery_address_1>
                <delivery_address_2></delivery_address_2>
                <delivery_city></delivery_city>
                <delivery_state></delivery_state>
                <delivery_country></delivery_country>
                <delivery_postcode></delivery_postcode>
                <delivery_telephone></delivery_telephone>
                <total_orders></total_orders>
                <average_order_value></average_order_value>
                <total_spend></total_spend>
                <last_order></last_order>
                <last_order_no></last_order_no>
            </customer_data>
            <address_book>
                <customers></customers>
                <subscribers></subscribers>
                <guest></guest>
            </address_book>
        </connector_data_field_settings>
        <connector_roi_page_tracking_settings>
            <page_tracking>
                <enabled>0</enabled>
            </page_tracking>
            <roi_tracking>
                <enabled>0</enabled>
            </roi_tracking>
        </connector_roi_page_tracking_settings>
        <connector_newsletter_subscription_settings>
            <customers_subscription_management>
                <default></default>
            </customers_subscription_management>
            <subscribers_subscription_management>
                <default></default>
            </subscribers_subscription_management>
        </connector_newsletter_subscription_settings>
        <lost_basket_settings>
            <active><active></active></active>
            <customers>
                <enabled_1>0</enabled_1>
                <send_after_1></send_after_1>
                <campaign_1></campaign_1>
                <enabled_2>0</enabled_2>
                <send_after_2></send_after_2>
                <campaign_2></campaign_2>
                <enabled_3>0</enabled_3>
                <send_after_3></send_after_3>
                <campaign_3></campaign_3>
            </customers>
            <guests>
                <enabled_1>0</enabled_1>
                <send_after_1></send_after_1>
                <campaign_1></campaign_1>
                <enabled_2>0</enabled_2>
                <send_after_2></send_after_2>
                <campaign_2></campaign_2>
                <enabled_3>0</enabled_3>
                <send_after_3></send_after_3>
                <campaign_3></campaign_3>
            </guests>
            <test>
                <email></email>
            </test>
        </lost_basket_settings>
        <sms_section>
            <sms_message_one>
                <enabled>0</enabled>
                <order_status></order_status>
                <message></message>
            </sms_message_one>
            <sms_message_two>
                <enabled>0</enabled>
                <order_status></order_status>
                <message></message>
            </sms_message_two>
            <sms_message_three>
                <enabled>0</enabled>
                <order_status></order_status>
                <message></message>
            </sms_message_three>
            <sms_message_four>
                <enabled>0</enabled>
                <order_status></order_status>
                <message></message>
            </sms_message_four>
        </sms_section>
        <dynamic_content>
            <products>
                <related_display_type>list</related_display_type>
                <related_items_to_display>2</related_items_to_display>
                <upsell_display_type>list</upsell_display_type>
                <upsell_items_to_display>2</upsell_items_to_display>
                <crosssell_display_type>list</crosssell_display_type>
                <crosssell_items_to_display>2</crosssell_items_to_display>
                <best_display_type>list</best_display_type>
                <best_items_to_display>2</best_items_to_display>
                <most_viewed_display_type>list</most_viewed_display_type>
                <most_viewed_items_to_display>2</most_viewed_items_to_display>
                <recently_viewed_display_type>list</recently_viewed_display_type>
                <recently_viewed_items_to_display>2</recently_viewed_items_to_display>
            </products>
            <manual_product_search>
                <display_type>list</display_type>
                <items_to_display>2</items_to_display>
                <products_push_items></products_push_items>
            </manual_product_search>
            <fallback_products>
                <product_list></product_list>
            </fallback_products>
        </dynamic_content>
        <transactional_emails>
            <transactional_email>
                <api_username></api_username>
                <api_password></api_password>
            </transactional_email>
            <email_mapping>
                <new_creditmemo></new_creditmemo>
                <new_creditmemo_guest></new_creditmemo_guest>
                <creditmemo></creditmemo>
                <new_invoice></new_invoice>
                <invoice_update></invoice_update>
                <new_order></new_order>
                <order_update></order_update>
                <new_shipment></new_shipment>
                <shipment_update></shipment_update>
                <customer_emails_heading></customer_emails_heading>
                <password_remind></password_remind>
                <forgot_password></forgot_password>
                <new_account></new_account>
            </email_mapping>
        </transactional_emails>
        <connector_advanced_settings>
            <sync_limits>
                <orders>500</orders>
            </sync_limits>
            <external>
                <passcode>secret</passcode>
                <lost_basket_url></lost_basket_url>
                <coupon_code_title></coupon_code_title>
                <coupon_code_url></coupon_code_url>
                <dynamic_content_url></dynamic_content_url>
                <related_products_url></related_products_url>
                <upsell_products_url></upsell_products_url>
                <crosssell_products_url></crosssell_products_url>
                <best_sellers_url></best_sellers_url>
                <most_viewed_url></most_viewed_url>
                <product_push_url></product_push_url>
                <recently_viewed_url></recently_viewed_url>
                <transactional_customer_new></transactional_customer_new>
                <transactional_order_new></transactional_order_new>
                <transactional_order_creditmemo_new></transactional_order_creditmemo_new>
                <transactional_order_update></transactional_order_update>
                <transactional_invoice_new></transactional_invoice_new>
            </external>
            <admin>
                <memory_limit>0</memory_limit>
                <batch_size>10000</batch_size>
                <debug>0</debug>
            </admin>
        </connector_advanced_settings>
    </default>
    <phpunit>
        <suite>
            <modules>
                <Dotdigitalgroup_Email />
            </modules>
        </suite>
    </phpunit>
</config>